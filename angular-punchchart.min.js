/*!
 * angular-punchchart v0.1.0
 * The MIT License
 * Copyright (c) 2015 Jan Antala <hello@janantala.com>
 */

!function(){"use strict";var t=angular.module("pygmalios.punchchart",[]);t.directive("punchChart",["$window",function(t){var a=function(t){var a=1;return t.forEach(function(t){t.forEach(function(t){t>a&&(a=t)})}),a};return{restrict:"EA",scope:{chartData:"=",xlabels:"=",ylabels:"=",options:"="},template:'<svg width="100%" height="100%" viewBox="0 0 800 300" preserveAspectRatio="xMaxYMax"></svg>',link:function(e,l,n){var s,r,o,i,c,h,f,y,p,u=800,x=300,g=10,v=30,d=30,b=30,w=30,m=12,D=t.d3,E=l.find("svg"),O=D.select(E[0]),C=D.tip().attr("class","d3-tip").offset([-10,0]);O.call(C);var F=function(){h=a(e.chartData),y=e.chartData.length,p=e.chartData[0]?e.chartData[0].length:1,w=(x-g-d)/(e.ylabels.length+1),b=(u-d)/(e.xlabels.length+1),m=w>b?Math.floor(9*b/20):Math.floor(9*w/20),f=h/m,e.options=e.options||{},s=e.options.PUNCT_COLOR||"#62BFCE",r=e.options.LABEL_COLOR||"#7F7F7F",o=e.options.LINE_COLOR||"#D0D0D0",i=e.options.FONT_SIZE||10,c=e.options.FONT_WEIGHT||100},L=function(){for(var t=0;t<e.ylabels.length;t++)O.append("svg:text").attr("class","ylabel").attr("x",v).attr("y",(t+1)*w+g).attr("dy","0.25em").attr("text-anchor","end").style("font-family","Helvetica").style("font-size",i).style("font-weight",c).style("fill",r).text(e.ylabels[t]),O.append("svg:line").attr("class","line").attr("x1",1*v+.25*v).attr("y1",(t+1)*w+g).attr("x2",(1+e.xlabels.length)*b+.75*b).attr("y2",(t+1)*w+g).style("stroke",o).style("stroke-width",.5);for(var a=0;a<e.xlabels.length;a++)O.append("svg:text").attr("class","xlabel").attr("x",(a+1)*b+v).attr("y",(e.ylabels.length+1)*w+g).attr("text-anchor","middle").style("font-family","Helvetica").style("font-size",i).style("font-weight",c).style("fill",r).text(e.xlabels[a]),O.append("svg:line").attr("class","line").attr("x1",(a+1)*b+v).attr("y1",1*w+g-.75*w).attr("x2",(a+1)*b+v).attr("y2",(1+e.ylabels.length)*w+g-.25*w).style("stroke",o).style("stroke-width",.5)},k=function(){for(var t=0;y>t&&t<e.ylabels.length;t++)for(var a=0;p>a&&a<e.xlabels.length;a++)O.append("svg:circle").attr("class","circle").attr("cx",(a+1)*b+v).attr("cy",(t+1)*w+g).attr("r",e.chartData[t][a]/f).attr("data",e.chartData[t][a]).attr("fill",s).on("mouseover",function(){C.html(D.select(this).attr("data")),C.show()}).on("mouseout",C.hide)},$=function(){O.selectAll("*").remove(),F(),L(),k()};e.$watch("chartData",function(t,a){t!==a&&$()}),e.$watch("xlabels",function(t,a){t!==a&&$()}),e.$watch("ylabels",function(t,a){t!==a&&$()}),e.$watch("options",function(t,a){t!==a&&$()}),$()}}}])}();
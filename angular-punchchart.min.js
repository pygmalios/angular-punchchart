/*!
 * angular-punchchart v0.2.0
 * The MIT License
 * Copyright (c) 2016 Jan Antala <hello@janantala.com>
 */

!function(){"use strict";var t=angular.module("pygmalios.punchchart",[]);t.directive("punchChart",["$window",function(t){var a=function(t){var a=0;return t.forEach(function(t){t.forEach(function(t){t>a&&(a=t)})}),a};return{restrict:"EA",scope:{chartData:"=",xlabels:"=",ylabels:"=",options:"="},template:'<svg width="100%" height="100%" viewBox="0 0 800 300" preserveAspectRatio="xMaxYMax"></svg>',link:function(e,l,r){var n,s,o,c,i,h,f,y,u,p=800,g=300,v=10,x=30,d=30,b=30,D=30,w=12,F=t.d3,m=l.find("svg"),E=F.select(m[0]),O=F.tip().attr("class","d3-tip").offset([-10,0]);E.call(O);var L=function(){e.chartData=e.chartData||[],h=a(e.chartData),y=e.chartData.length,u=e.chartData[0]?e.chartData[0].length:0,D=(g-v-d)/(e.ylabels.length+1),b=(p-d)/(e.xlabels.length+1),w=D>b?Math.floor(9*b/20):Math.floor(9*D/20),f=h/w||1,e.options=e.options||{},n=e.options.PUNCT_COLOR,s=e.options.LABEL_COLOR||"#7F7F7F",o=e.options.LINE_COLOR||"#D0D0D0",c=e.options.FONT_SIZE||10,i=e.options.FONT_WEIGHT||100},k=function(t){if(n)return n;var a=t/h,e="blue";return a>.3&&(e="#00EFFE"),a>.5&&(e="#AFFF4E"),a>.7&&(e="#FF6F40"),a>.9&&(e="red"),console.log(a,e),e},A=function(){for(var t=0;t<e.ylabels.length;t++)E.append("svg:text").attr("class","ylabel").attr("x",x).attr("y",(t+1)*D+v).attr("dy","0.25em").attr("text-anchor","end").style("font-family","Helvetica").style("font-size",c).style("font-weight",i).style("fill",s).text(e.ylabels[t]),E.append("svg:line").attr("class","line").attr("x1",1*x+.25*x).attr("y1",(t+1)*D+v).attr("x2",(1+e.xlabels.length)*b+.75*b).attr("y2",(t+1)*D+v).style("stroke",o).style("stroke-width",.5);for(var a=0;a<e.xlabels.length;a++)E.append("svg:text").attr("class","xlabel").attr("x",(a+1)*b+x).attr("y",(e.ylabels.length+1)*D+v).attr("text-anchor","middle").style("font-family","Helvetica").style("font-size",c).style("font-weight",i).style("fill",s).text(e.xlabels[a]),E.append("svg:line").attr("class","line").attr("x1",(a+1)*b+x).attr("y1",1*D+v-.75*D).attr("x2",(a+1)*b+x).attr("y2",(1+e.ylabels.length)*D+v-.25*D).style("stroke",o).style("stroke-width",.5)},C=function(){for(var t=0;y>t&&t<e.ylabels.length;t++)for(var a=0;u>a&&a<e.xlabels.length;a++)E.append("svg:circle").attr("class","circle").attr("cx",(a+1)*b+x).attr("cy",(t+1)*D+v).attr("r",e.chartData[t][a]/f).attr("data",e.chartData[t][a]).attr("fill",k(e.chartData[t][a])).on("mouseover",function(){O.html(F.select(this).attr("data")),O.show()}).on("mouseout",O.hide)},$=function(){E.selectAll("*").remove(),L(),A(),C()};e.$watch("chartData",function(t,a){t!==a&&$()}),e.$watch("xlabels",function(t,a){t!==a&&$()}),e.$watch("ylabels",function(t,a){t!==a&&$()}),e.$watch("options",function(t,a){t!==a&&$()}),$()}}}])}();